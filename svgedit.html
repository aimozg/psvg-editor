<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Hello...</title>
	<!--<script src="out/production/tfgame/lib/kotlin.js"></script>-->
	<!--<script src="out/production/tfgame/tfgame.js"></script>-->
	<script type="text/javascript" src="js/vendor.js"></script>
	<script type="text/javascript" src="js/svgedit.js"></script>
	<style type="text/css">
		body {
			margin: 0;
			overflow:hidden;
			min-height: 100vh;
		}
		.frow {
			display: flex;
			flex-wrap: nowrap;
			flex-direction: row;
		}
		.frows {
			display: flex;
			flex-wrap: wrap;
			flex-direction: row;
		}
		.fcol {
			display: flex;
			flex-wrap: nowrap;
			flex-direction: column;
		}
		.fcols {
			display: flex;
			flex-wrap: wrap;
			flex-direction: column;
		}
		.ffix {
			flex-grow: 0;
			flex-shrink: 0;
		}
		.fgrow {
			flex-grow: 1;
			flex-shrink: 0;
		}
		.fstretch {
			flex-grow: 1;
			flex-shrink: 1;
		}
		#main {
			height: 100vh;
		}
		.canvas {
			overflow:scroll;
			border: 1px solid red;
			/*width:100%;*/
			height:100%;
			background:#033;
			box-sizing: border-box;
		}
		.canvas svg {
			display: block;
			margin: 0 auto;
			min-height: 100%;
		}
		#treeview, #objview {
			overflow-y:auto;
		}
		.jstree {
			user-select: none;
		}
		.viewport {
			fill: #000;
		}
		.modelpane-edit .path > path,
		.modelpane-edit .segment > path {
			stroke-width:4;
			stroke-opacity:0.5;
			pointer-events: stroke;
			fill:none;
			vector-effect:non-scaling-stroke;
		}
		.modelpane-edit .path > path {
			stroke:#808080;
		}
		.modelpane-edit.point {
			stroke-width:2;
			stroke:transparent;
		}
		line.handle,
		line.lineref{
			stroke-width: 2;
			stroke-opacity: 1;
			vector-effect:non-scaling-stroke;
		}
		line.lineref {
			stroke-dasharray: 2 2;
		}
		.handles-visible .pt_handle,
		.handles-visible line.handle,
		.refs-visible line.lineref,
		.nodes-visible .node > use
		{
			stroke:#444;
		}
		:not(.group).-selected line.handle,
		.-selected use{
			stroke:#088;
			stroke-opacity: 1;
		}
		:not(.group).-selected .path > path,
		.-selected.path > path {
			stroke: #fff;
			stroke-opacity: 1;
		}
		.segment > path:hover {
			stroke:#ffff00;
			stroke-opacity: 1;
		}
		.node.-selected.-primary > line.handle,
		.node.-selected.-primary > line.lineref,
		.node.-selected.-primary > use,
		.path.-selected.-primary > path,
		.segment.-selected.-primary > path,
		.handle.-selected.-primary line,
		.point.-selected.-primary,
		.point.-selected.-primary > line.handle,
		.point.-selected.-primary > line.lineref,
		.point.-selected.-primary > use {
			stroke:#0ff;
			stroke-opacity: 1;
		}
		.modelpane-edit .point > use {
			fill:#fff;
		}
		.modelpane-edit .point > use[href="#svg_FixedPoint"] {
			fill:#ff0000;
			stroke-width:2;
			stroke:#fff;
		}
		.modelpane-edit .point > use[href="#svg_FixedPoint"]:hover {
			fill:#ffff00;
		}
		.modelpane-edit .point.-selected > use[href="#svg_FixedPoint"] {
			stroke:#088;
		}
		.modelpane-edit .point.-selected.-primary > use[href="#svg_FixedPoint"] {
			stroke:#0ff;
		}
		#svg_CuspNode, #svg_SmoothNode, #svg_Flow1Node {
			fill:transparent;
			stroke-width:2;
			stroke:inherit;
		}
		.Value {
			display: flex;
			margin: 2px 0;
		}
		.Value > label {
			flex-basis: 20%;
			margin: 0 4px;
		}
		.Value > input {
			flex-basis: 80%;
			margin: 0 4px;
		}
		.Value > input.-error {
			color: #ff0000;
		}
	</style>
</head>
<body>
<div id="main" class="fcol">
	<div id="toolbar frow">
		<h2 id="name">name goes here</h2>
		<button type="button" onclick="editor_load3()">Reset demo</button>
		<button type="button" onclick="editor_save()">Save to localStorage</button>
		<!--<button type="button" onclick="editor_load1()">Load from file</button>-->
		<button type="button" onclick="editor_load2()">Load from localStorage</button>
		<span style="float:right;">
			Ctrl+Wheel to zoom. Click to select. <span style="background:#000;color:#f00">FixedPoints</span> are draggable.
		</span>
	</div>
	<div class="frow">
		<div class="fcol">
			<div class="canvas canvas-preview fstretch">
			</div>
			<div class="canvas canvas-preview fstretch">
			</div>
		</div>
		<div class="canvas canvas-editor fstretch">
		</div>
		<div class="fcol" style="flex-basis:300px;">
			<div id="sidebar" class="fcol">
				<div id="treeview"></div>
				<div id="objview">

				</div>
			</div>
		</div>
	</div>
</div>
</body>
<script type="text/javascript">
    var editor;
    var sourceLoaded = new $.Deferred();
    $(function () {
        var n = document.body.firstChild;
        var purge = [];
        do {
            if (n.nodeType === Node.TEXT_NODE) purge.push(n);
        } while (n = n.nextSibling);
        for (var i = 0; i < purge.length; i++)document.body.removeChild(purge[i]);
        var canvas = $('.canvas-editor');
        canvas.css('height', (document.body.clientHeight - canvas.offset().top).toFixed() + 'px');
        editor = svgedit.setup(canvas[0],
            $('#treeview')[0],
            $('.canvas-preview').toArray(),
            $('#objview')[0]);
        editor.zoom = 4;
        editor_load3();
    });
    function editor_save() {
        localStorage.setItem('svgedit_model',JSON.stringify(editor.save()));
        alert('Done!');
    }
    function editor_load2() {
        var data = localStorage.getItem('svgedit_model');
        if (data) {
            editor.loadJson(JSON.parse(data));
            $("#name").text(editor.model.name);
        } else editor_load3();
    }
    function editor_load3() {
        $.getJSON('res/demoface.json',function(json){
            editor.loadJson(json);
            //editor.zoom = 4;
            $("#name").text(editor.model.name);
        });
    }
    function editor_load1() {
        $.when($(function () {
        }), sourceLoaded).then(function () {

            var source = $('#source');
            //console.log(source[0].contentDocument.readyState);
            //console.log(window.temp1=source[0].contentDocument);
            var struct = source[0].contentDocument.getElementById('layer14');
            editor.loadSvgStruct(struct);
            source.remove();

            $("#name").text(editor.model.name);
        });
    }
</script>
</html>
